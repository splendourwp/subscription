!function(c){window.onLoadPPReCaptcha=function(){var r,e=c(".pp-grecaptcha");0<e.length&&e.each(function(e){var s=c(this),i=s.attr("data-widgetid"),t=c(this).attr("id");typeof i!=typeof undefined&&!1!==i||(s.attr("id",t),r=grecaptcha.render(t,{sitekey:s.data("sitekey"),theme:s.data("theme"),size:s.data("validate"),callback:function(e){""!=e&&(s.attr("data-pp-grecaptcha-response",e),"invisible"==s.data("validate")&&s.closest(".elementor-widget").find(".pp-submit-button").trigger("click"))}}),s.attr("data-widgetid",r))})},PPRegistrationForm=function(e,s){this.settings=s,this.nodeClass=e,this.i18n=s.i18n,this.messages=s.i18n.messages,this.form=c(this.nodeClass).find(".pp-registration-form"),this.fields={},this.errorCodes={},this._init()},PPRegistrationForm.prototype={settings:{},nodeClass:"",messages:{},isValid:!0,fields:{},errorCodes:{},_init:function(){this.form.length<1||(this._initFields(),this._bindErrorCodes(),this._bindEvents(),this._initReCaptcha())},_initReCaptcha:function(){var e=this.nodeClass.find(".pp-grecaptcha");elementorFrontend.isEditMode()&&undefined==e.attr("data-widgetid")&&onLoadPPReCaptcha()},_initFields:function(){this.fields={user_login:this.form.find('.pp-rf-field[data-field-type="user_login"]'),user_email:this.form.find('.pp-rf-field[data-field-type="user_email"]'),user_pass:this.form.find('.pp-rf-field[data-field-type="user_pass"]'),confirm_user_pass:this.form.find('.pp-rf-field[data-field-type="confirm_user_pass"]'),user_url:this.form.find('.pp-rf-field[data-field-type="user_url"]'),first_name:this.form.find('.pp-rf-field[data-field-type="first_name"]'),last_name:this.form.find('.pp-rf-field[data-field-type="last_name"]'),consent:this.form.find('.pp-rf-field[data-field-type="consent"]'),recaptcha:this.form.find('.pp-rf-field[data-field-type="recaptcha"]')},Object.keys(this.fields).forEach(c.proxy(function(e){var s;void 0===e||0<(s=this.fields[e].find('.pp-rf-control[name="'+e+'"]')).length&&(this.fields[e].control=s)},this))},_bindErrorCodes:function(){this.errorCodes={empty_email:"user_email",invalid_email:"user_email",email_exists:"user_email",username_wp_error:"user_login",invalid_username:"user_login",username_exists:"user_login",password:"user_pass",password_mismatch:"confirm_user_pass",invalid_url:"user_url",recaptcha_php_ver:"recaptcha",recaptcha_missing_key:"recaptcha"}},_bindEvents:function(){0<this.fields.user_pass.find(".pp-rf-toggle-pw").length&&this.fields.user_pass.find(".pp-rf-toggle-pw").on("click",c.proxy(this._passwordToggle,this)),this.settings.pws_meter&&"undefined"!=typeof wp.passwordStrength&&this.fields.user_pass.control.on("input",c.proxy(this._beginPwsMeter,this)),this.nodeClass.find(".pp-button").on("click",c.proxy(this._submit,this))},_getFieldByCode:function(e){if("undefined"==typeof this.errorCodes[e])return!1;var s=this.errorCodes[e];return this.fields[s]},_getFormData:function(){var e=new FormData(this.nodeClass.find(".pp-registration-form")[0]);return e.append("referrer",location.toString()),e},_passwordToggle:function(){var e=this.fields.user_pass;"text"===e.control.attr("type")?(e.control.attr("type","password"),e.find(".pp-rf-toggle-pw").attr("aria-label",this.i18n.pw_toggle_text.show).find("span").removeClass("fa-eye-slash").addClass("fa-eye")):(e.control.attr("type","text"),e.find(".pp-rf-toggle-pw").attr("aria-label",this.i18n.pw_toggle_text.hide).find("span").removeClass("fa-eye").addClass("fa-eye-slash"))},_beginPwsMeter:function(e){var s=c(e.target).val(),i=this.fields.user_pass.find(".pp-rf-pws-status"),t=wp.passwordStrength.userInputBlacklist();switch(this.fields.confirm_user_pass.length,i.removeClass("short bad good strong"),wp.passwordStrength.meter(s,t,!1)){case 0:i.addClass("short").html(pwsL10n["short"]);break;case 1:i.addClass("bad").html(pwsL10n.bad);break;case 2:case 3:i.addClass("good").html(pwsL10n.good);break;case 4:i.addClass("strong").html(pwsL10n.strong)}""===s?i.removeClass("short bad good strong").html(""):this._removeErrorClass(this.fields.user_pass)},_submit:function(e){this.isValid=!0;var t,s,i,r,a=this.form,d=this.nodeClass.find(".pp-button"),n=this._getFormData(),o=this.nodeClass.find(".pp-grecaptcha"),l=o.data("pp-grecaptcha-response"),p=this.settings.ajaxurl,f=a.closest(".pp-rf-wrap").data("post-id"),h=(a.data("template-id"),a.data("template-node-id"),a.closest(".elementor-widget-pp-registration-form").data("id"));e.preventDefault(),d.hasClass("pp-disabled")||(a.find(".pp-rf-field").removeClass("pp-rf-field-error"),t=this,a.find(".pp-rf-field.elementor-mark-required").each(function(){var e=c(this),s=e.data("field-type"),i=c(this).find('[name="'+s+'"]');0<i.length&&("checkbox"===i.attr("type")||"radio"===i.attr("type")?i.is(":checked")?t._fieldHasError(e)&&t._removeErrorClass(e):(t.isValid=!1,t._addErrorClass(e)):i.val()&&""!==i.val()?t._fieldHasError(e)&&t._removeErrorClass(e):(t.isValid=!1,t._addErrorClass(e)))}),0<this.fields.user_email.length&&(""===(s=this.fields.user_email.find('input[type="email"]')).val()?(this.isValid=!1,this._addErrorClass(this.fields.user_email)):/\S+@\S+\.\S+/.test(s.val())?this._fieldHasError(this.fields.user_email)&&this._removeErrorClass(this.fields.user_email):(this.isValid=!1,this._removeErrorClass(this.fields.user_email),this._addInlineError(this.fields.user_email,this.messages.error.invalid_email))),0<this.fields.user_pass.length&&""!==(r=this.fields.user_pass.control).val()&&r.val().length<this.settings.min_pass_length&&(this.isValid=!1,this._addInlineError(this.fields.user_pass,this.messages.error.password_length)),0<this.fields.confirm_user_pass.length&&(i=this.fields.confirm_user_pass.find('input[name="confirm_user_pass"]').val(),r=this.fields.user_pass.find('input[name="user_pass"]').val(),""!==i&&btoa(i)!==btoa(r)&&(this.isValid=!1,this._addInlineError(this.fields.confirm_user_pass,this.messages.error.password_mismatch))),0<o.length&&this.isValid&&(void 0===l||!1===l?"normal"==o.data("validate")?(this.isValid=!1,this._addErrorClass(this.fields.recaptcha)):"invisible"==o.data("validate")&&grecaptcha.execute(o.data("widgetid")):this._removeErrorClass(this.fields.recaptcha)),this.isValid&&(d.addClass("pp-disabled"),0<o.length&&n.append("recaptcha",!0),l&&n.append("recaptcha_response",l),n.append("node_id",h),n.append("action","ppe_register_user"),n.append("security",a.data("nonce")),n.append("post_id",f),c.ajax({url:p,type:"POST",dataType:"json",data:n,processData:!1,contentType:!1,success:c.proxy(this._submitComplete,this),error:this._onError})))},_submitComplete:function(e){var s,i,t,r=this.nodeClass.find(" .pp-rf-success-none");if("undefined"==typeof e.success||!0!==e.success)return c(this.nodeClass).find(".pp-button").removeClass("pp-disabled"),"undefined"!=typeof e.data.message?(s=e.data,i=this._getFieldByCode(s.code),t="undefined"!=typeof this.messages.error[s.code]?this.messages.error[s.code]:s.message,i&&0<i.length?this._addInlineError(i,t):(this.nodeClass.find(" .pp-rf-failed-error").html(t),this.nodeClass.find(" .pp-rf-failed-error").fadeIn())):this.nodeClass.find(" .pp-rf-failed-error").fadeIn(),!1;this.nodeClass.find(" .pp-rf-failed-error").fadeOut(),"yes"!==e.data.auto_login||"undefined"!=typeof e.data.redirect_url&&""!==e.dataredirect_url?"undefined"!=typeof e.data.redirect_url?window.location.href=e.data.redirect_url:0<r.length?r.fadeIn():(this.nodeClass.find(".pp-registration-form").hide(),this.nodeClass.find(".pp-after-submit-action.pp-rf-success").fadeIn()):window.location.reload()},_onError:function(e,s){console.log(s)},_addInlineError:function(e,s){e.find(".pp-rf-error-inline").remove(),e.addClass("pp-rf-field-error").append('<span class="pp-rf-error-inline">'+s+"</span>")},_addErrorClass:function(e){e.addClass("pp-rf-validation-error")},_removeErrorClass:function(e){e.removeClass("pp-rf-validation-error")},_fieldHasError:function(e){return e.hasClass("pp-rf-validation-error")}}}(jQuery);